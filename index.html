<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NAGOYA 2026 ğŸˆ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'muji-bg': '#F9F9F4',       /* ç±³ç™½ç´™å¼µè‰² */
                        'muji-gray': '#F2F2EB',     /* æ·ºç°å€å¡Š */
                        'cat-orange': '#E06C38',    /* æ·±æ©˜è²“è‰² */
                        'cat-dark': '#594A42',      /* æ·±è¤æ–‡å­— */
                        'cat-light': '#FFF0E6',     /* æ·ºæ©˜èƒŒæ™¯ */
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 15px rgba(224, 108, 56, 0.08)',
                        'card': '0 2px 8px rgba(0,0,0,0.04)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F9F9F4;
            color: #594A42;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px; /* Space for bottom nav */
        }
        
        /* éš±è— Scrollbar ä½†ä¿æŒæ»‘å‹•æ©Ÿèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* è²“å’ªè€³æœµå½¢ç‹€çš„ Tab */
        .nav-active {
            color: #E06C38;
            position: relative;
        }
        .nav-active::after {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid #E06C38;
        }

        /* Input Reset */
        .input-reset {
            appearance: none;
            outline: none;
            border: 1px solid #E5E7EB;
            transition: all 0.2s;
        }
        .input-reset:focus {
            border-color: #E06C38;
            background-color: #FFF;
            box-shadow: 0 0 0 3px rgba(224, 108, 56, 0.1);
        }

        /* å¡ç‰‡å‹•ç•« */
        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="font-sans antialiased">

    <header class="fixed top-0 w-full z-40 bg-muji-bg/95 backdrop-blur-md border-b border-orange-100 shadow-sm transition-all duration-300">
        <div class="max-w-md mx-auto px-4 h-16 flex items-center justify-center relative">
            <div class="absolute left-4 text-cat-orange text-2xl">
                <i class="fa-solid fa-cat"></i>
            </div>
            <h1 class="text-lg font-bold tracking-widest text-cat-dark">NAGOYA <span class="text-cat-orange">2026</span></h1>
            <div class="absolute right-4 text-cat-dark/50 text-xs font-mono">
                FEB 06-14
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto pt-20 px-4">

        <section id="view-plan" class="view-section block fade-in">
            <div class="bg-white rounded-xl p-4 mb-6 shadow-card border-l-4 border-cat-orange relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-gray-100 text-6xl rotate-12">
                    <i class="fa-solid fa-plane"></i>
                </div>
                <div class="relative z-10">
                    <h3 class="text-xs font-bold text-cat-orange mb-2 tracking-wider">FLIGHT INFO</h3>
                    <div class="flex justify-between items-center mb-3 pb-3 border-b border-dashed border-gray-200">
                        <div>
                            <div class="text-2xl font-bold">TPE</div>
                            <div class="text-xs text-gray-400">07:35</div>
                        </div>
                        <div class="text-center flex-1 px-2">
                            <div class="text-xs text-cat-orange font-bold">CI 0154</div>
                            <div class="h-[1px] bg-cat-orange w-full my-1 relative">
                                <i class="fa-solid fa-plane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-cat-orange text-xs bg-white px-1"></i>
                            </div>
                            <div class="text-xs text-gray-400">2h 30m</div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold">NGO</div>
                            <div class="text-xs text-gray-400">11:05</div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-xl font-bold text-gray-600">NGO</div>
                            <div class="text-xs text-gray-400">09:50</div>
                        </div>
                        <div class="text-center flex-1 px-2">
                            <div class="text-xs text-gray-400">CI 0151</div>
                            <div class="h-[1px] bg-gray-300 w-full my-1"></div>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-bold text-gray-600">TPE</div>
                            <div class="text-xs text-gray-400">12:15</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex gap-2 overflow-x-auto no-scrollbar mb-6 pb-2">
                <button onclick="renderDay(1)" class="day-btn active flex-shrink-0 w-14 h-16 rounded-xl bg-cat-orange text-white flex flex-col items-center justify-center shadow-soft transition-transform transform active:scale-95">
                    <span class="text-xs opacity-80">D1</span>
                    <span class="font-bold text-lg">06</span>
                </button>
                <button onclick="alert('ç¯„ä¾‹ï¼šåˆ‡æ›è‡³ Day 2')" class="day-btn flex-shrink-0 w-14 h-16 rounded-xl bg-white text-gray-400 flex flex-col items-center justify-center border border-gray-100">
                    <span class="text-xs">D2</span>
                    <span class="font-bold text-lg">07</span>
                </button>
                 <button onclick="alert('ç¯„ä¾‹ï¼šåˆ‡æ›è‡³ Day 3')" class="day-btn flex-shrink-0 w-14 h-16 rounded-xl bg-white text-gray-400 flex flex-col items-center justify-center border border-gray-100">
                    <span class="text-xs">D3</span>
                    <span class="font-bold text-lg">08</span>
                </button>
                </div>

            <div id="itinerary-list" class="space-y-4">
                </div>
        </section>

        <section id="view-guide" class="view-section hidden fade-in">
            <h2 class="text-2xl font-bold mb-4 text-cat-dark border-b-4 border-cat-orange inline-block">TRAVEL GUIDE</h2>
            
            <div class="space-y-6">
                <div class="bg-white rounded-xl overflow-hidden shadow-card">
                    <div class="h-40 bg-gray-200 relative group cursor-pointer" onclick="alert('åœ°åœ–è¼‰å…¥ä¸­...')">
                        <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=136.525,34.840,136.545,34.855&amp;layer=mapnik" style="border: 1px solid black"></iframe>
                        <div class="absolute bottom-2 right-2 bg-white/90 text-xs px-2 py-1 rounded shadow">
                            <i class="fa-solid fa-map-location-dot text-cat-orange"></i> éˆ´é¹¿è³½è»Šæ¨‚åœ’
                        </div>
                    </div>
                    <div class="p-5">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bg-cat-orange text-white text-[10px] px-2 py-0.5 rounded-full tracking-wide">æ™¯é»</span>
                            <h3 class="font-bold text-lg">éˆ´é¹¿è³½è»Šæ¨‚åœ’ (Suzuka Circuit)</h3>
                        </div>
                        <p class="text-sm text-gray-500 leading-relaxed text-justify mb-3">
                            æ—¥æœ¬æœ€è‘—åçš„ F1 è³½é“ä¹‹ä¸€ã€‚é™¤äº†è§€çœ‹è³½äº‹ï¼Œé€™è£¡é‚„æœ‰åç‚ºã€ŒMotopiaã€çš„éŠæ¨‚åœ’ï¼Œè¨±å¤šè¨­æ–½éƒ½ä»¥é§•é§›é«”é©—ç‚ºä¸»é¡Œï¼Œéå¸¸é©åˆè¦ªå­åŒæ¨‚ã€‚
                        </p>
                        <div class="bg-cat-light p-3 rounded-lg text-xs text-cat-dark/80">
                            <strong class="text-cat-orange">ğŸ’¡ å°å†·çŸ¥è­˜ï¼š</strong> é€™è£¡çš„æ‘©å¤©è¼ªæ˜¯å…¨æ—¥æœ¬å”¯ä¸€å¯ä»¥åœ¨è»Šå»‚å…§çœ‹åˆ° F1 è³½é“å…¨æ™¯çš„åœ°æ–¹å–”ï¼
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-5 shadow-card">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full tracking-wide">ç¾é£Ÿ</span>
                        <h3 class="font-bold text-lg">åå¤å±‹æµæ—©é¤</h3>
                    </div>
                    <p class="text-sm text-gray-500 leading-relaxed text-justify">
                        åå¤å±‹æœ‰ç¨ç‰¹çš„ã€Œé»é£²æ–™é€æ—©é¤ã€æ–‡åŒ–ï¼ˆMorning Serviceï¼‰ã€‚åªè¦åœ¨æ—©ä¸Šå‰å¾€å–«èŒ¶åº—é»ä¸€æ¯å’–å•¡ï¼Œé€šå¸¸æœƒé™„è´ˆåå¸èˆ‡æ°´ç…®è›‹ï¼Œä¸€å®šè¦é«”é©—ï¼
                    </p>
                </div>
            </div>
        </section>

        <section id="view-wallet" class="view-section hidden fade-in">
            <div class="bg-cat-dark text-white rounded-xl p-5 mb-6 shadow-soft">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-xs opacity-60">ç›®å‰åŒ¯ç‡ (JPY -> TWD)</p>
                        <div class="flex items-baseline gap-2">
                            <span class="text-lg">0.</span>
                            <input type="number" id="exchange-rate" value="215" class="bg-transparent text-2xl font-bold w-16 border-b border-white/30 focus:border-cat-orange outline-none text-center">
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-xs opacity-60">ç¸½æ”¯å‡º (NTD)</p>
                        <p class="text-3xl font-bold text-cat-orange" id="total-twd">0</p>
                    </div>
                </div>
                
                <div class="bg-white/10 rounded-lg p-3 backdrop-blur-sm">
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="expense-item" placeholder="å“é … (å¦‚: æ‹‰éºµ)" class="w-2/3 bg-transparent border-b border-gray-500 text-white placeholder-gray-400 focus:border-cat-orange outline-none py-1">
                        <label class="w-1/3 flex items-center justify-center bg-white/20 rounded cursor-pointer hover:bg-white/30 transition">
                            <i class="fa-solid fa-camera text-sm mr-1"></i> <span class="text-xs">ç›¸ç‰‡</span>
                            <input type="file" id="expense-photo" accept="image/*" class="hidden" capture="environment">
                        </label>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="expense-amount" placeholder="é‡‘é¡ (å¯è¼¸å…¥ 500+200)" class="flex-1 bg-transparent border-b border-gray-500 text-white placeholder-gray-400 focus:border-cat-orange outline-none py-1 text-lg font-mono">
                        <button onclick="addExpense()" class="bg-cat-orange text-white px-4 py-1 rounded font-bold shadow-lg active:scale-95 transition">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-end mb-2 px-1">
                <h3 class="font-bold text-gray-400 text-sm">SPENDING HISTORY</h3>
                <button onclick="clearExpenses()" class="text-xs text-red-300 underline">é‡ç½®</button>
            </div>
            
            <div id="expense-list" class="space-y-3 pb-20">
                </div>
        </section>

        <section id="view-lists" class="view-section hidden fade-in">
            <div class="mb-8">
                <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-suitcase-rolling text-cat-orange"></i> è¡Œå‰æª¢æŸ¥
                </h2>
                <div id="checklist-container" class="space-y-2">
                    </div>
            </div>

            <div>
                <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-note-sticky text-cat-orange"></i> å‚™å¿˜éŒ„ (Memo)
                </h2>
                <div class="bg-white rounded-xl shadow-card p-4">
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="memo-input" placeholder="è¼¸å…¥æ–‡å­—æˆ–ç¶²å€..." class="input-reset flex-1 rounded-lg px-3 py-2 bg-muji-bg">
                        <button onclick="addMemo()" class="bg-gray-200 w-10 rounded-lg text-gray-600 hover:bg-cat-orange hover:text-white transition"><i class="fa-solid fa-plus"></i></button>
                    </div>
                    <div id="memo-list" class="space-y-2">
                        </div>
                </div>
            </div>
        </section>

        <section id="view-info" class="view-section hidden fade-in">
            <div class="grid grid-cols-2 gap-4 mb-6">
                <a href="https://www.jma.go.jp/bosai/forecast/" target="_blank" class="bg-blue-50 p-4 rounded-xl flex flex-col items-center justify-center gap-2 shadow-sm border border-blue-100 hover:bg-blue-100 transition">
                    <i class="fa-solid fa-cloud-sun-rain text-3xl text-blue-400"></i>
                    <span class="font-bold text-blue-800 text-sm">å¤©æ°£é å ±</span>
                </a>
                <a href="https://www.google.com/maps/search/drugstore" target="_blank" class="bg-green-50 p-4 rounded-xl flex flex-col items-center justify-center gap-2 shadow-sm border border-green-100 hover:bg-green-100 transition">
                    <i class="fa-solid fa-cart-shopping text-3xl text-green-400"></i>
                    <span class="font-bold text-green-800 text-sm">é™„è¿‘è—¥å¦</span>
                </a>
            </div>

            <div class="bg-white rounded-xl p-5 shadow-card border-l-4 border-red-400 mb-6">
                <h3 class="font-bold text-red-500 mb-3"><i class="fa-solid fa-triangle-exclamation"></i> ç·Šæ€¥è¯çµ¡</h3>
                <ul class="space-y-2 text-sm">
                    <li class="flex justify-between border-b border-gray-100 pb-1"><span>ğŸ‘® è­¦å¯Ÿå±€</span> <span class="font-mono font-bold">110</span></li>
                    <li class="flex justify-between border-b border-gray-100 pb-1"><span>ğŸš‘ æ•‘è­·è»Š/ç«è­¦</span> <span class="font-mono font-bold">119</span></li>
                    <li class="flex justify-between"><span>ğŸ‡¹ğŸ‡¼ é§æ—¥ä»£è¡¨è™•</span> <span class="font-mono font-bold">080-1009-7179</span></li>
                </ul>
            </div>

            <div class="bg-cat-light rounded-xl p-5 shadow-sm">
                <h3 class="font-bold text-cat-orange mb-3">ğŸ± æ—…éŠå°è²¼å£«</h3>
                <ul class="list-disc pl-5 text-sm text-gray-600 space-y-2">
                    <li>æ—¥æœ¬é›»è»Šå…§è«‹ä¿æŒå®‰éœï¼Œæ‰‹æ©Ÿèª¿æˆéœ‡å‹•ã€‚</li>
                    <li>è³¼ç‰©æ»¿ 5500 æ—¥åœ“å¯é€€ç¨…ï¼Œè¨˜å¾—å¸¶è­·ç…§ã€‚</li>
                    <li>åå¤å±‹ç‚¸é›ç¿…èˆ‡é°»é­šé£¯ä¸‰åƒæ˜¯å¿…åƒç¾é£Ÿï¼</li>
                </ul>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-100 pb-safe-area z-50 shadow-[0_-4px_20px_rgba(0,0,0,0.03)]">
        <div class="flex justify-around items-center h-16 max-w-md mx-auto">
            <button onclick="switchTab('plan')" class="nav-btn nav-active flex flex-col items-center gap-1 w-1/5 text-gray-400" data-target="plan">
                <i class="fa-solid fa-calendar-days text-xl"></i>
                <span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            <button onclick="switchTab('guide')" class="nav-btn flex flex-col items-center gap-1 w-1/5 text-gray-400" data-target="guide">
                <i class="fa-solid fa-book-open text-xl"></i>
                <span class="text-[10px] font-bold">å°è¦½</span>
            </button>
            <button onclick="switchTab('wallet')" class="nav-btn flex flex-col items-center gap-1 w-1/5 text-gray-400" data-target="wallet">
                <div class="bg-cat-orange text-white rounded-full w-12 h-12 flex items-center justify-center -mt-6 shadow-soft border-4 border-muji-bg">
                    <i class="fa-solid fa-wallet text-lg"></i>
                </div>
                <span class="text-[10px] font-bold mt-1">è¨˜å¸³</span>
            </button>
            <button onclick="switchTab('lists')" class="nav-btn flex flex-col items-center gap-1 w-1/5 text-gray-400" data-target="lists">
                <i class="fa-solid fa-list-check text-xl"></i>
                <span class="text-[10px] font-bold">æ¸…å–®</span>
            </button>
            <button onclick="switchTab('info')" class="nav-btn flex flex-col items-center gap-1 w-1/5 text-gray-400" data-target="info">
                <i class="fa-solid fa-circle-info text-xl"></i>
                <span class="text-[10px] font-bold">è³‡è¨Š</span>
            </button>
        </div>
    </nav>

    <div id="img-modal" class="fixed inset-0 bg-black/90 z-[60] hidden flex items-center justify-center p-4" onclick="this.classList.add('hidden')">
        <img id="img-modal-content" src="" class="max-w-full max-h-[80vh] rounded shadow-2xl">
    </div>

    <script>
        // === è³‡æ–™ä¸­å¿ƒ ===
        const APP_DATA = {
            day1: [
                { time: '03:30', title: 'æ©Ÿå ´æ¥é€', desc: 'å®¶è£¡ -> æ¡ƒåœ’æ©Ÿå ´', type: 'transport', icon: 'fa-car' },
                { time: '07:35', title: 'é£›å¾€åå¤å±‹ (CI 0154)', desc: 'TPE T1 -> NGO T1', type: 'transport', icon: 'fa-plane-departure', highlight: true },
                { time: '11:05', title: 'æŠµé”åå¤å±‹ä¸­éƒ¨æ©Ÿå ´', desc: 'å…¥å¢ƒã€æ‹¿è¡Œæ', type: 'normal', icon: 'fa-person-arrival' },
                { time: '12:00', title: 'å–è»Š (ç§Ÿè»Šä¸­å¿ƒ)', address: '1-1 Centrair, Tokoname, Aichi 479-0881', desc: 'æª¢æŸ¥è»Šæ³ã€å°èˆªè¨­å®š', type: 'key', icon: 'fa-key' },
                { time: '13:30', title: 'JR Gate Tower Mall', address: '1-1-4 Meieki, Nakamura-ku, Nagoya', desc: 'ä¸­é¤ & é€› Bic Camera', type: 'food', icon: 'fa-utensils' },
                { time: '16:00', title: 'å‰å¾€éˆ´é¹¿', desc: 'è»Šç¨‹ç´„ 1 å°æ™‚', type: 'transport', icon: 'fa-road' },
                { time: '17:30', title: 'å…¥ä½ï¼šéˆ´é¹¿è³½è»Šæ¨‚åœ’é…’åº—', address: '7992 Inoucho, Suzuka, Mie 510-0201', desc: 'Check-in ä¼‘æ¯', type: 'stay', icon: 'fa-bed', highlight: true }
            ],
            checklist: [
                "è­·ç…§ (æœ‰æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)", "Visit Japan Web QR Code", "ç¶²å¡ / Roaming é–‹é€š", "é§•ç…§æ—¥æ–‡è­¯æœ¬", "è¡Œå‹•é›»æº", "å€‹äººè—¥å“", "æ—¥å¹£ç¾é‡‘"
            ]
        };

        // === åˆå§‹åŒ– ===
        document.addEventListener('DOMContentLoaded', () => {
            renderItinerary();
            renderChecklist();
            renderMemos();
            renderExpenses();
            
            // è™•ç†ç…§ç‰‡ä¸Šå‚³é è¦½èˆ‡å£“ç¸®
            document.getElementById('expense-photo').addEventListener('change', handlePhotoUpload);
        });

        // === 1. å°èˆªåˆ‡æ›é‚è¼¯ ===
        function switchTab(targetId) {
            // éš±è—æ‰€æœ‰ Section
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + targetId).classList.remove('hidden');
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('nav-active', 'text-cat-orange');
                btn.classList.add('text-gray-400');
                if(btn.dataset.target === targetId) {
                    btn.classList.add('nav-active', 'text-cat-orange');
                    btn.classList.remove('text-gray-400');
                }
            });

            window.scrollTo(0,0);
        }

        // === 2. è¡Œç¨‹è¡¨é‚è¼¯ (å« Google Map é€£çµ) ===
        function getGoogleMapLink(address) {
            return `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(address)}`;
        }

        function renderItinerary() {
            const container = document.getElementById('itinerary-list');
            let html = '';

            APP_DATA.day1.forEach(item => {
                const isHighlight = item.highlight ? 'bg-cat-light border-l-4 border-cat-orange' : 'bg-white border-l-4 border-gray-200';
                const timeColor = item.highlight ? 'text-cat-orange font-bold' : 'text-gray-500 font-medium';
                
                // åœ°å€æŒ‰éˆ•
                let mapBtn = '';
                if (item.address) {
                    mapBtn = `
                        <a href="${getGoogleMapLink(item.address)}" target="_blank" class="mt-2 inline-flex items-center gap-1 bg-gray-100 hover:bg-cat-orange hover:text-white text-gray-600 px-3 py-1 rounded-full text-xs transition">
                            <i class="fa-solid fa-location-arrow"></i> å°èˆª
                        </a>
                    `;
                }

                html += `
                    <div class="relative pl-6 pb-2 last:pb-0">
                        <div class="absolute left-[7px] top-2 bottom-0 w-[2px] bg-gray-200"></div>
                        <div class="absolute left-0 top-2 w-4 h-4 rounded-full border-2 border-white ${item.highlight ? 'bg-cat-orange' : 'bg-gray-300'} z-10"></div>
                        
                        <div class="card ${isHighlight} rounded-xl p-4 shadow-card mb-2 ml-2">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="${timeColor} text-sm mb-1">${item.time}</div>
                                    <h4 class="font-bold text-gray-800 text-base">${item.title}</h4>
                                    <p class="text-xs text-gray-500 mt-1">${item.desc}</p>
                                    ${mapBtn}
                                </div>
                                <div class="text-gray-300 text-xl opacity-50">
                                    <i class="fa-solid ${item.icon}"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // === 3. è¨˜å¸³èˆ‡åŒ¯ç‡é‚è¼¯ ===
        let tempPhotoBase64 = null;

        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // è®€å–æª”æ¡ˆä¸¦å£“ç¸®
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // è¨­å®šå£“ç¸®å¾Œå¯¬åº¦
                    const maxWidth = 400;
                    const scaleSize = maxWidth / img.width;
                    canvas.width = maxWidth;
                    canvas.height = img.height * scaleSize;
                    
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    
                    // è½‰ç‚º Base64
                    tempPhotoBase64 = canvas.toDataURL('image/jpeg', 0.7);
                    alert("ğŸ“· ç…§ç‰‡å·²æº–å‚™å¥½ï¼");
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        }

        function addExpense() {
            const itemInput = document.getElementById('expense-item');
            const amountInput = document.getElementById('expense-amount');
            
            if (!itemInput.value || !amountInput.value) {
                alert("è«‹è¼¸å…¥é …ç›®èˆ‡é‡‘é¡");
                return;
            }

            // è¨ˆç®—å­—ä¸²ç®—å¼
            let amount = 0;
            try {
                // å®‰å…¨æ€§æ³¨æ„ï¼šåœ¨å–®æ©Ÿç°¡æ˜“ç’°å¢ƒä¸‹ä½¿ç”¨ Function å»ºæ§‹å­åšé‹ç®—
                amount = new Function('return ' + amountInput.value)();
            } catch (e) {
                alert("é‡‘é¡æ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥æ•¸å­—æˆ–ç®—å¼");
                return;
            }

            const expense = {
                id: Date.now(),
                item: itemInput.value,
                amount: amount,
                date: new Date().toLocaleString(),
                photo: tempPhotoBase64
            };

            // å­˜å…¥ LocalStorage
            const expenses = JSON.parse(localStorage.getItem('myTripExpenses') || '[]');
            expenses.unshift(expense);
            localStorage.setItem('myTripExpenses', JSON.stringify(expenses));

            // æ¸…ç©ºè¼¸å…¥
            itemInput.value = '';
            amountInput.value = '';
            tempPhotoBase64 = null;
            document.getElementById('expense-photo').value = '';

            renderExpenses();
        }

        function renderExpenses() {
            const expenses = JSON.parse(localStorage.getItem('myTripExpenses') || '[]');
            const list = document.getElementById('expense-list');
            const rate = parseFloat(document.getElementById('exchange-rate').value) / 1000; // 0.215
            
            let totalJPY = 0;
            
            list.innerHTML = expenses.map(exp => {
                totalJPY += exp.amount;
                const twd = Math.round(exp.amount * rate);
                
                return `
                    <div class="bg-white p-3 rounded-lg shadow-sm border border-gray-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            ${exp.photo ? 
                                `<img src="${exp.photo}" onclick="document.getElementById('img-modal').classList.remove('hidden');document.getElementById('img-modal-content').src='${exp.photo}'" class="w-10 h-10 object-cover rounded bg-gray-200 cursor-pointer">` : 
                                `<div class="w-10 h-10 bg-gray-100 rounded flex items-center justify-center text-gray-300"><i class="fa-solid fa-yen-sign"></i></div>`
                            }
                            <div>
                                <div class="font-bold text-gray-700">${exp.item}</div>
                                <div class="text-[10px] text-gray-400">${exp.date.split(',')[0]}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-lg text-cat-dark">Â¥${exp.amount}</div>
                            <div class="text-xs text-gray-400">â‰ˆ $${twd}</div>
                        </div>
                    </div>
                `;
            }).join('');

            // æ›´æ–°ç¸½é‡‘é¡
            document.getElementById('total-twd').innerText = Math.round(totalJPY * rate).toLocaleString();
        }

        function clearExpenses() {
            if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è¨˜å¸³ç´€éŒ„å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚')) {
                localStorage.removeItem('myTripExpenses');
                renderExpenses();
            }
        }

        // === 4. Checklist & Memo é‚è¼¯ ===
        function renderChecklist() {
            const savedState = JSON.parse(localStorage.getItem('myTripChecklist') || '{}');
            const container = document.getElementById('checklist-container');
            
            container.innerHTML = APP_DATA.checklist.map(item => {
                const isChecked = savedState[item] ? 'checked' : '';
                const textClass = savedState[item] ? 'line-through text-gray-400' : 'text-gray-700';
                
                return `
                    <label class="flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-100 shadow-sm cursor-pointer select-none transition hover:bg-gray-50">
                        <input type="checkbox" class="w-5 h-5 accent-cat-orange rounded" ${isChecked} onchange="toggleCheck('${item}')">
                        <span class="${textClass}">${item}</span>
                    </label>
                `;
            }).join('');
        }

        function toggleCheck(item) {
            const savedState = JSON.parse(localStorage.getItem('myTripChecklist') || '{}');
            savedState[item] = !savedState[item];
            localStorage.setItem('myTripChecklist', JSON.stringify(savedState));
            renderChecklist();
        }

        function addMemo() {
            const input = document.getElementById('memo-input');
            const text = input.value.trim();
            if(!text) return;

            const memos = JSON.parse(localStorage.getItem('myTripMemos') || '[]');
            memos.unshift({ id: Date.now(), text: text });
            localStorage.setItem('myTripMemos', JSON.stringify(memos));
            
            input.value = '';
            renderMemos();
        }

        function renderMemos() {
            const memos = JSON.parse(localStorage.getItem('myTripMemos') || '[]');
            const container = document.getElementById('memo-list');
            
            container.innerHTML = memos.map(memo => {
                // è‡ªå‹•å°‡ç¶²å€è½‰æ›ç‚ºé€£çµ
                let content = memo.text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" class="text-blue-500 underline break-all"><i class="fa-solid fa-link"></i> Link</a>');
                
                return `
                    <div class="flex justify-between items-start border-b border-gray-100 last:border-0 py-2">
                        <div class="text-sm text-gray-600 break-words flex-1 pr-2">${content}</div>
                        <button onclick="deleteMemo(${memo.id})" class="text-gray-300 hover:text-red-400 px-2"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                `;
            }).join('');
        }

        function deleteMemo(id) {
            let memos = JSON.parse(localStorage.getItem('myTripMemos') || '[]');
            memos = memos.filter(m => m.id !== id);
            localStorage.setItem('myTripMemos', JSON.stringify(memos));
            renderMemos();
        }

        // åŒ¯ç‡è¼¸å…¥æ¡†ç›£è½
        document.getElementById('exchange-rate').addEventListener('input', renderExpenses);

    </script>
</body>
</html>
