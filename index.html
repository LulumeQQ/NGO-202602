<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>名古屋滑雪之旅 - 202602</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'muji-bg': '#F9F7F2',       /* 暖米白 (紙張感) */
                        'muji-card': '#FFFFFF',     /* 純白卡片 */
                        'cat-orange': '#CC5500',    /* 深橘色 (貓咪強調色) */
                        'cat-orange-light': '#FFF0E5',
                        'text-dark': '#4A4A4A',     /* 深灰 (比純黑柔和) */
                        'text-light': '#8C8C8C',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', '"Lato"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #F9F7F2;
            color: #4A4A4A;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* 隱藏 Scrollbar 但保持滑動功能 */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 底部導航列安全區 (for iPhone X+) */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Input Range Style */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            background: #CC5500;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            margin-top: -4px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
        }

        /* Selected Card Animation */
        .selected-card {
            border: 2px solid #CC5500;
            background-color: #FFF8F4;
            transform: scale(1.01);
            transition: all 0.3s ease;
        }
        
        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #CC5500;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="font-sans antialiased h-screen flex flex-col overflow-hidden">

    <header class="flex-none bg-muji-bg px-5 pt-10 pb-4 shadow-sm z-20">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold tracking-widest text-cat-orange">NAGOYA</h1>
                <p class="text-xs text-text-light tracking-wide">2026.02.06 - 02.14 <i class="fa-solid fa-plane"></i></p>
            </div>
            <div class="text-right">
                <span class="text-xs font-bold bg-cat-orange text-white px-2 py-1 rounded-md shadow-sm">
                    <i class="fa-solid fa-snowflake mr-1"></i>滑雪之旅
                </span>
            </div>
        </div>
    </header>

    <main id="app-content" class="flex-1 overflow-y-auto hide-scrollbar pb-24 px-4 pt-2">
        </main>

    <nav class="flex-none bg-white border-t border-gray-100 pb-safe fixed bottom-0 w-full z-30 shadow-[0_-2px_10px_rgba(0,0,0,0.03)]">
        <div class="grid grid-cols-5 h-16">
            <button onclick="router('plan')" class="nav-btn group flex flex-col items-center justify-center text-text-light hover:text-cat-orange active:text-cat-orange transition-colors" data-target="plan">
                <i class="fa-solid fa-map-location-dot text-lg mb-1 group-[.active]:text-cat-orange"></i>
                <span class="text-[10px] font-medium group-[.active]:text-cat-orange">行程</span>
            </button>
            <button onclick="router('guide')" class="nav-btn group flex flex-col items-center justify-center text-text-light hover:text-cat-orange active:text-cat-orange transition-colors" data-target="guide">
                <i class="fa-solid fa-book-open text-lg mb-1 group-[.active]:text-cat-orange"></i>
                <span class="text-[10px] font-medium group-[.active]:text-cat-orange">導覽</span>
            </button>
            <button onclick="router('wallet')" class="nav-btn group flex flex-col items-center justify-center text-text-light hover:text-cat-orange active:text-cat-orange transition-colors" data-target="wallet">
                <i class="fa-solid fa-wallet text-lg mb-1 group-[.active]:text-cat-orange"></i>
                <span class="text-[10px] font-medium group-[.active]:text-cat-orange">記帳</span>
            </button>
            <button onclick="router('lists')" class="nav-btn group flex flex-col items-center justify-center text-text-light hover:text-cat-orange active:text-cat-orange transition-colors" data-target="lists">
                <i class="fa-solid fa-list-check text-lg mb-1 group-[.active]:text-cat-orange"></i>
                <span class="text-[10px] font-medium group-[.active]:text-cat-orange">清單</span>
            </button>
            <button onclick="router('info')" class="nav-btn group flex flex-col items-center justify-center text-text-light hover:text-cat-orange active:text-cat-orange transition-colors" data-target="info">
                <i class="fa-solid fa-circle-info text-lg mb-1 group-[.active]:text-cat-orange"></i>
                <span class="text-[10px] font-medium group-[.active]:text-cat-orange">資訊</span>
            </button>
        </div>
    </nav>

    <script>
        // --- DATA & STATE ---
        const tripData = {
            flight: {
                outbound: "CI 0154 | TPE 07:35 -> NGO 11:05",
                inbound: "CI 0151 | NGO 09:50 -> TPE 12:15"
            },
            itinerary: {
                d1: [
                    { time: "03:30", title: "機場接送", desc: "家裡 -> 桃園機場", icon: "fa-car", highlight: true },
                    { time: "07:35", title: "起飛 CI 0154", desc: "飛往名古屋", icon: "fa-plane-departure" },
                    { time: "11:05", title: "抵達名古屋", desc: "中部國際機場 (NGO)", icon: "fa-plane-arrival" },
                    { time: "12:00", title: "取車", desc: "1-chōme−1 1 第一, Tokoname, Aichi", address: "〒479-0881 Aichi, Tokoname, Centrair, 1-chōme−1 1 第一, 日本", icon: "fa-key", highlight: true },
                    { time: "13:30", title: "JR Gate Tower Mall", desc: "中餐 & 逛 Bic Camera", address: "1-1-4 Meieki, Nakamura-ku, Nagoya-shi, Aichi 450-6001", icon: "fa-utensils" },
                    { time: "16:00", title: "前往飯店", desc: "移動至三重縣鈴鹿市", icon: "fa-route" },
                    { time: "18:00", title: "住宿: 鈴鹿賽車樂園酒店", desc: "Check-in 休息", address: "7992 Inoucho, Suzuka, Mie 510-0201日本", icon: "fa-bed" }
                ],
                d2: [
                    { time: "09:00", title: "鈴鹿賽車樂園", desc: "玩好玩滿，直到 17:00", icon: "fa-flag-checkered", highlight: true },
                    { time: "12:00", title: "樂園午餐", desc: "園區內用餐", icon: "fa-burger" },
                    { time: "17:00", title: "離開樂園", desc: "前往名古屋市區", icon: "fa-car-side" },
                    { time: "19:00", title: "住宿: Airbnb", desc: "愛知縣名古屋市", address: "愛知縣名古屋市緑區鳴海町字作町26號", icon: "fa-house-user" }
                ]
            }
        };

        const guideData = [
            {
                title: "鈴鹿賽車場",
                subtitle: "Suzuka Circuit",
                content: "日本最著名的賽車場之一，也是F1日本大獎賽的舉辦地。這裡不僅有賽道，還有名為 Motopia 的遊樂園。這裡的吉祥物是來自手塚治虫筆下的角色。對於車迷來說，這裡是聖地；對於家庭來說，這裡是寓教於樂的交通安全教育中心。",
                imageKeywords: "Suzuka Circuit"
            },
            {
                title: "JR Gate Tower",
                subtitle: "名古屋新地標",
                content: "與名古屋車站直結的超高層複合式大樓。Bic Camera 位於 9-10 樓，是購買電器與攝影器材的好去處。12-13 樓的餐廳街匯集了名古屋著名的鰻魚飯、味噌豬排等美食。高樓層還擁有全日本最高的星巴克。",
                imageKeywords: "Nagoya JR Gate Tower"
            }
        ];

        let state = {
            currentTab: 'plan',
            planDay: 'd1',
            selectedItineraryId: null, // 用於記錄哪個行程被選取
            walletItems: JSON.parse(localStorage.getItem('wallet_data')) || [],
            exchangeRate: localStorage.getItem('exchange_rate') || 0.22,
            checklist: JSON.parse(localStorage.getItem('checklist_data')) || [
                { id: 1, text: "護照", done: false },
                { id: 2, text: "網卡 / Roaming", done: false },
                { id: 3, text: "日幣現金", done: false },
                { id: 4, text: "信用卡 (海外回饋高)", done: false },
                { id: 5, text: "滑雪手套/襪子", done: false },
                { id: 6, text: "行動電源", done: false }
            ],
            memo: localStorage.getItem('memo_data') || ""
        };

        // --- ROUTING & RENDERING ---
        
        function router(tabName) {
            state.currentTab = tabName;
            
            // Update Nav Styles
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.target === tabName) {
                    btn.classList.add('active', 'text-cat-orange');
                    btn.classList.remove('text-text-light');
                } else {
                    btn.classList.remove('active', 'text-cat-orange');
                    btn.classList.add('text-text-light');
                }
            });

            // Render Content
            const app = document.getElementById('app-content');
            app.innerHTML = ''; // Clear current

            switch(tabName) {
                case 'plan': renderPlan(app); break;
                case 'guide': renderGuide(app); break;
                case 'wallet': renderWallet(app); break;
                case 'lists': renderLists(app); break;
                case 'info': renderInfo(app); break;
            }
        }

        // --- MODULE: PLAN (行程) ---
        function renderPlan(container) {
            const isD1 = state.planDay === 'd1';
            
            let html = `
                <div class="mb-4 sticky top-0 bg-muji-bg z-10 py-2">
                    <div class="flex justify-center space-x-4">
                        <button onclick="switchDay('d1')" class="px-6 py-2 rounded-full text-sm font-bold transition-all shadow-sm ${isD1 ? 'bg-cat-orange text-white' : 'bg-white text-text-light'}">
                            Day 1 (02/06)
                        </button>
                        <button onclick="switchDay('d2')" class="px-6 py-2 rounded-full text-sm font-bold transition-all shadow-sm ${!isD1 ? 'bg-cat-orange text-white' : 'bg-white text-text-light'}">
                            Day 2 (02/07)
                        </button>
                    </div>
                </div>
                
                <div class="space-y-4 pb-4">
            `;

            const currentItinerary = tripData.itinerary[state.planDay];
            
            currentItinerary.forEach((item, index) => {
                const uniqueId = `${state.planDay}-${index}`;
                const isSelected = state.selectedItineraryId === uniqueId;
                const mapLink = item.address ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.address)}` : null;
                
                html += `
                    <div id="${uniqueId}" onclick="selectItinerary('${uniqueId}')" class="relative flex bg-white rounded-xl shadow-sm p-4 cursor-pointer transition-all ${isSelected ? 'selected-card' : 'border border-transparent'}">
                        ${isSelected ? '<div class="absolute -top-2 -right-2 bg-cat-orange text-white w-8 h-8 rounded-full flex items-center justify-center shadow-md z-10"><i class="fa-solid fa-paw"></i></div>' : ''}
                        
                        <div class="flex flex-col items-center mr-4 w-12 pt-1">
                            <span class="text-sm font-bold ${isSelected ? 'text-cat-orange' : 'text-text-dark'}">${item.time}</span>
                            <div class="h-full w-0.5 bg-gray-200 my-2 ${isSelected ? 'bg-cat-orange opacity-50' : ''}"></div>
                        </div>
                        
                        <div class="flex-1 pb-2">
                            <div class="flex items-center mb-1">
                                <i class="fa-solid ${item.icon} mr-2 ${item.highlight ? 'text-cat-orange' : 'text-gray-400'}"></i>
                                <h3 class="font-bold text-lg ${item.highlight ? 'text-cat-orange' : 'text-text-dark'}">${item.title}</h3>
                            </div>
                            <p class="text-sm text-text-light mb-2">${item.desc}</p>
                            
                            ${mapLink ? `
                                <a href="${mapLink}" target="_blank" onclick="event.stopPropagation()" class="inline-flex items-center px-3 py-1.5 bg-gray-100 rounded-lg text-xs font-medium text-gray-600 hover:bg-gray-200 transition">
                                    <i class="fa-solid fa-location-dot mr-1.5 text-cat-orange"></i>
                                    導航 / Google Maps
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            container.innerHTML = html;
            
            // Auto scroll to selected if exists
            if(state.selectedItineraryId) {
                setTimeout(() => {
                    const el = document.getElementById(state.selectedItineraryId);
                    if(el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        function switchDay(day) {
            state.planDay = day;
            renderPlan(document.getElementById('app-content'));
        }

        function selectItinerary(id) {
            // Toggle selection logic: if same clicked, deselect? Or just always select.
            // Requirement says "Single selection logic".
            if (state.selectedItineraryId === id) {
                state.selectedItineraryId = null; // Optional: deselect if clicked again
            } else {
                state.selectedItineraryId = id;
            }
            renderPlan(document.getElementById('app-content'));
        }

        // --- MODULE: GUIDE (導覽) ---
        function renderGuide(container) {
            let html = `<div class="space-y-6">`;
            
            guideData.forEach(item => {
                html += `
                    <article class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="h-32 bg-gray-200 flex items-center justify-center text-gray-400">
                             <span class="text-sm"><i class="fa-regular fa-image mr-1"></i> ${item.title}</span>
                        </div>
                        <div class="p-5">
                            <h2 class="text-xl font-bold text-text-dark mb-1 font-serif">${item.title}</h2>
                            <p class="text-xs text-cat-orange font-bold uppercase tracking-wide mb-3">${item.subtitle}</p>
                            <p class="text-sm text-gray-600 leading-relaxed text-justify">
                                <span class="float-left text-3xl font-serif pr-1 mt-[-6px] text-text-dark">${item.content.charAt(0)}</span>${item.content.slice(1)}
                            </p>
                        </div>
                    </article>
                `;
            });
            
            html += `</div>`;
            container.innerHTML = html;
        }

        // --- MODULE: WALLET (記帳) ---
        function renderWallet(container) {
            const totalYen = state.walletItems.reduce((sum, item) => sum + item.amount, 0);
            const totalTwd = Math.round(totalYen * state.exchangeRate);
            
            let html = `
                <div class="bg-cat-orange text-white rounded-2xl p-5 shadow-lg mb-6 relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="text-xs opacity-90 mb-1">目前總支出</div>
                        <div class="text-3xl font-bold mb-1">¥${totalYen.toLocaleString()}</div>
                        <div class="text-sm opacity-80">≈ NT$${totalTwd.toLocaleString()}</div>
                    </div>
                    <div class="absolute right-[-20px] bottom-[-20px] text-white opacity-10 text-9xl">
                        <i class="fa-solid fa-coins"></i>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="bg-white p-3 rounded-xl shadow-sm">
                        <label class="block text-[10px] text-gray-400 font-bold mb-1">匯率設定 (JPY -> TWD)</label>
                        <input type="number" step="0.001" value="${state.exchangeRate}" onchange="updateRate(this.value)" class="w-full text-lg font-bold text-text-dark border-b border-gray-200 focus:outline-none focus:border-cat-orange bg-transparent pb-1">
                    </div>
                    
                     <div class="bg-white p-3 rounded-xl shadow-sm">
                        <label class="block text-[10px] text-gray-400 font-bold mb-1">計算機 (輸入如 500*2)</label>
                        <div class="flex items-center">
                            <input type="text" id="calcInput" placeholder="100+50..." class="w-full text-sm font-bold text-text-dark border-b border-gray-200 focus:outline-none focus:border-cat-orange bg-transparent pb-1">
                            <button onclick="calculate()" class="ml-2 text-cat-orange"><i class="fa-solid fa-equals"></i></button>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
                    <h3 class="font-bold text-sm text-text-dark mb-3 border-l-4 border-cat-orange pl-2">新增記帳</h3>
                    <div class="space-y-3">
                        <input type="text" id="itemName" placeholder="品項名稱 (如: 拉麵)" class="w-full bg-gray-50 rounded-lg px-3 py-2 text-sm focus:ring-1 focus:ring-cat-orange outline-none">
                        
                        <div class="flex space-x-2">
                            <input type="number" id="itemPrice" placeholder="金額 (日幣)" class="flex-1 bg-gray-50 rounded-lg px-3 py-2 text-sm focus:ring-1 focus:ring-cat-orange outline-none">
                            
                            <label class="flex items-center justify-center w-12 bg-gray-100 rounded-lg cursor-pointer text-gray-500 hover:bg-gray-200 hover:text-cat-orange transition">
                                <i class="fa-solid fa-camera"></i>
                                <input type="file" id="itemPhoto" accept="image/*" capture="environment" class="hidden" onchange="handlePhotoUpload(this)">
                            </label>
                            
                            <button onclick="addWalletItem()" class="bg-cat-orange text-white px-4 rounded-lg text-sm shadow-md hover:bg-[#b04a00] transition">
                                <i class="fa-solid fa-plus"></i>
                            </button>
                        </div>
                        <div id="photoPreview" class="hidden text-xs text-cat-orange items-center">
                            <i class="fa-solid fa-check-circle mr-1"></i> 已選取照片
                        </div>
                    </div>
                </div>

                <div class="space-y-3 pb-8">
                    <h3 class="font-bold text-sm text-gray-400 px-1">消費紀錄</h3>
                    ${state.walletItems.slice().reverse().map((item, idx) => `
                        <div class="bg-white rounded-xl p-3 shadow-sm flex items-center justify-between">
                            <div class="flex items-center space-x-3 overflow-hidden">
                                ${item.img ? `<div class="w-10 h-10 rounded-lg bg-gray-100 bg-cover bg-center flex-shrink-0" style="background-image: url('${item.img}')" onclick="viewImage('${item.img}')"></div>` 
                                           : `<div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center text-gray-300 flex-shrink-0"><i class="fa-solid fa-bag-shopping"></i></div>`}
                                <div class="truncate">
                                    <div class="text-sm font-bold text-text-dark truncate">${item.name}</div>
                                    <div class="text-[10px] text-gray-400">${new Date(item.date).toLocaleDateString()}</div>
                                </div>
                            </div>
                            <div class="text-right flex-shrink-0">
                                <div class="text-sm font-bold text-text-dark">¥${item.amount.toLocaleString()}</div>
                                <div class="text-[10px] text-gray-400">NT$${Math.round(item.amount * state.exchangeRate).toLocaleString()}</div>
                                <button onclick="deleteWalletItem(${state.walletItems.length - 1 - idx})" class="text-[10px] text-red-300 ml-1 p-1"><i class="fa-solid fa-trash"></i></button>
                            </div>
                        </div>
                    `).join('')}
                    ${state.walletItems.length === 0 ? '<div class="text-center text-gray-300 text-sm py-4">尚無記帳資料</div>' : ''}
                </div>
            `;
            container.innerHTML = html;
        }

        // Wallet Helpers
        let tempBase64Img = null;

        function updateRate(val) {
            state.exchangeRate = parseFloat(val);
            localStorage.setItem('exchange_rate', state.exchangeRate);
            renderWallet(document.getElementById('app-content'));
        }

        function calculate() {
            const input = document.getElementById('calcInput');
            try {
                // 安全性注意: Eval 在此單機 App 環境尚可接受，但嚴謹專案應使用 Parser
                // 過濾非數字與運算符
                const clean = input.value.replace(/[^0-9+\-*/().]/g, '');
                if (!clean) return;
                const result = eval(clean);
                input.value = result;
                // 顯示換算台幣
                const twd = Math.round(result * state.exchangeRate);
                alert(`計算結果: ¥${result}\n約合台幣: NT$${twd}`);
            } catch (e) {
                alert("算式錯誤");
            }
        }

        function handlePhotoUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                
                // 壓縮圖片邏輯
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const MAX_WIDTH = 400; // 縮小尺寸以節省 LocalStorage
                        const scaleSize = MAX_WIDTH / img.width;
                        canvas.width = MAX_WIDTH;
                        canvas.height = img.height * scaleSize;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        tempBase64Img = canvas.toDataURL('image/jpeg', 0.6); // 壓縮品質 0.6
                        
                        document.getElementById('photoPreview').classList.remove('hidden');
                        document.getElementById('photoPreview').classList.add('flex');
                    }
                }
                reader.readAsDataURL(file);
            }
        }

        function addWalletItem() {
            const name = document.getElementById('itemName').value;
            const price = parseFloat(document.getElementById('itemPrice').value);
            
            if (!name || isNaN(price)) {
                alert("請輸入名稱與金額");
                return;
            }

            state.walletItems.push({
                name: name,
                amount: price,
                date: new Date().toISOString(),
                img: tempBase64Img
            });

            localStorage.setItem('wallet_data', JSON.stringify(state.walletItems));
            tempBase64Img = null; // reset
            renderWallet(document.getElementById('app-content'));
        }
        
        function deleteWalletItem(realIndex) {
            if(confirm("確定刪除此筆資料？")) {
                state.walletItems.splice(realIndex, 1);
                localStorage.setItem('wallet_data', JSON.stringify(state.walletItems));
                renderWallet(document.getElementById('app-content'));
            }
        }

        function viewImage(base64) {
            // 簡易的燈箱效果
            const w = window.open("");
            w.document.write(`<img src="${base64}" style="width:100%">`);
        }

        // --- MODULE: LISTS (清單) ---
        function renderLists(container) {
            let html = `
                <div class="bg-white rounded-xl shadow-sm p-5 mb-6">
                    <h3 class="font-bold text-lg text-text-dark mb-4 flex items-center">
                        <i class="fa-solid fa-suitcase text-cat-orange mr-2"></i> 行前準備
                    </h3>
                    <div class="space-y-3">
            `;
            
            state.checklist.forEach(item => {
                html += `
                    <label class="flex items-center space-x-3 cursor-pointer group">
                        <div class="relative flex items-center">
                            <input type="checkbox" onchange="toggleCheck(${item.id})" class="peer appearance-none w-5 h-5 border-2 border-gray-300 rounded checked:bg-cat-orange checked:border-cat-orange transition-colors" ${item.done ? 'checked' : ''}>
                            <i class="fa-solid fa-check text-white absolute left-1 top-1 text-xs opacity-0 peer-checked:opacity-100 pointer-events-none"></i>
                        </div>
                        <span class="text-sm text-gray-700 peer-checked:text-gray-400 peer-checked:line-through transition-all">${item.text}</span>
                    </label>
                `;
            });
            
            html += `
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-5 pb-16">
                    <h3 class="font-bold text-lg text-text-dark mb-2 flex items-center">
                        <i class="fa-solid fa-pen-to-square text-cat-orange mr-2"></i> 備忘錄
                    </h3>
                    <p class="text-[10px] text-gray-400 mb-2">輸入網址會自動轉換為連結</p>
                    <textarea id="memoInput" class="w-full h-32 p-3 bg-gray-50 rounded-lg text-sm mb-3 focus:outline-none focus:ring-1 focus:ring-cat-orange resize-none" placeholder="輸入筆記...">${state.memo}</textarea>
                    <button onclick="saveMemo()" class="w-full bg-text-dark text-white py-2 rounded-lg text-sm font-bold shadow-sm hover:bg-black transition">儲存備忘</button>
                    
                    <div id="memoLinks" class="mt-4 space-y-2">
                        ${renderMemoLinks(state.memo)}
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        function toggleCheck(id) {
            const item = state.checklist.find(i => i.id === id);
            if (item) {
                item.done = !item.done;
                localStorage.setItem('checklist_data', JSON.stringify(state.checklist));
                renderLists(document.getElementById('app-content'));
            }
        }

        function saveMemo() {
            const val = document.getElementById('memoInput').value;
            state.memo = val;
            localStorage.setItem('memo_data', val);
            renderLists(document.getElementById('app-content'));
        }

        function renderMemoLinks(text) {
            if (!text) return '';
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const matches = text.match(urlRegex);
            if (!matches) return '';
            
            return matches.map(url => `
                <a href="${url}" target="_blank" class="block bg-gray-100 p-2 rounded flex items-center text-xs text-blue-600 truncate hover:bg-gray-200">
                    <i class="fa-solid fa-link mr-2 text-gray-400"></i> ${url}
                </a>
            `).join('');
        }

        // --- MODULE: INFO (資訊) ---
        function renderInfo(container) {
            container.innerHTML = `
                <div class="space-y-4">
                    <a href="https://www.jma.go.jp/bosai/forecast/" target="_blank" class="block bg-blue-50 border border-blue-100 p-4 rounded-xl shadow-sm flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-500 mr-3">
                                <i class="fa-solid fa-cloud-sun"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-text-dark">天氣預報</h3>
                                <p class="text-xs text-gray-500">日本氣象廳 (JMA)</p>
                            </div>
                        </div>
                        <i class="fa-solid fa-chevron-right text-gray-300"></i>
                    </a>

                    <div class="bg-white p-5 rounded-xl shadow-sm">
                        <h3 class="font-bold text-lg mb-3 text-cat-orange">航班資訊</h3>
                        <div class="space-y-3">
                            <div class="border-l-4 border-gray-200 pl-3">
                                <p class="text-xs text-gray-400">去程</p>
                                <p class="text-sm font-bold text-text-dark">${tripData.flight.outbound}</p>
                            </div>
                            <div class="border-l-4 border-gray-200 pl-3">
                                <p class="text-xs text-gray-400">回程</p>
                                <p class="text-sm font-bold text-text-dark">${tripData.flight.inbound}</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-red-50 border border-red-100 p-5 rounded-xl shadow-sm">
                        <h3 class="font-bold text-lg mb-3 text-red-600">緊急聯絡</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white p-3 rounded-lg text-center shadow-sm">
                                <i class="fa-solid fa-user-shield text-2xl text-red-500 mb-1"></i>
                                <div class="text-xs text-gray-500">警察</div>
                                <div class="font-bold text-xl">110</div>
                            </div>
                            <div class="bg-white p-3 rounded-lg text-center shadow-sm">
                                <i class="fa-solid fa-truck-medical text-2xl text-red-500 mb-1"></i>
                                <div class="text-xs text-gray-500">救護/火警</div>
                                <div class="font-bold text-xl">119</div>
                            </div>
                        </div>
                        <div class="mt-3 text-xs text-gray-600 leading-relaxed">
                            <span class="font-bold">台北駐大阪經濟文化辦事處:</span><br>
                            電話：(81-6) 6227-8623<br>
                            緊急聯絡：(81-90) 8794-4568
                        </div>
                    </div>

                    <div class="bg-white p-5 rounded-xl shadow-sm">
                        <h3 class="font-bold text-lg mb-2 text-text-dark">旅遊須知</h3>
                        <ul class="list-disc list-outside ml-4 text-sm text-gray-600 space-y-1">
                            <li>日本電壓 100V (雙平腳插座)，台灣電器通常通用。</li>
                            <li>垃圾請務必分類，街頭垃圾桶較少，建議自備塑膠袋帶回飯店丟。</li>
                            <li>搭乘手扶梯在名古屋通常靠左站立（關東左、關西右，名古屋偏左）。</li>
                            <li>入境肉類製品嚴格禁止（含肉乾、肉鬆）。</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // --- INIT ---
        window.onload = function() {
            router('plan'); // Start at Plan
        };

    </script>
</body>
</html>
